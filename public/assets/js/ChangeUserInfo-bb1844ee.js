import"./base-9ed7a3b4.js";import{E as P,a as I}from"./el-form-item-a5242619.js";import{E as V}from"./el-button-3b2ee6a5.js";import{E as b}from"./el-input-feb7aa1f.js";import{d as v,r as f,a as E,k as F,m as C,e as R,R as h,w as a,b as n,u as r,q as k,s as S}from"./index-fee14184.js";import{i as q}from"./admin-b20f8c58.js";import{E as p}from"./request-56692d6c.js";import"./use-form-item-70fcde04.js";import"./_initCloneObject-6cd35402.js";import"./index-61ed4cec.js";import"./isNil-c75b1b34.js";const x=v("ChangeUserInfo",()=>{const u=f({nowPassword:"",newPassword:"",confirmPassword:"",newUsername:"",pending:!1}),d=f(null);return{changeUserInfoForm:u,changeUserInfoFormRef:d}}),G=E({__name:"ChangeUserInfo",setup(u){const d=F(),w=x(),{changeUserInfoForm:e,changeUserInfoFormRef:i}=C(w),g={nowPassword:[{required:!0,message:"请输入旧密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"}]},c=async m=>{if(!m||!await m.validate(()=>{}))return;if(e.value.newPassword!==e.value.confirmPassword)return p.error("两次密码不一致");e.value.pending=!0;const o=await q({...e.value,newUsername:e.value.newUsername??""})??"failed";e.value.pending=!1,o.toString()!=="failed"&&(p.success("修改成功"),S("0"),d.push("/login"))};return(m,o)=>{const l=b,t=P,U=V,_=I;return R(),h(_,{ref_key:"changeUserInfoFormRef",ref:i,model:r(e),rules:g,"label-width":"auto"},{default:a(()=>[n(t,{label:"新的用户名(为空就是不改)",prop:"newUsername"},{default:a(()=>[n(l,{modelValue:r(e).newUsername,"onUpdate:modelValue":o[0]||(o[0]=s=>r(e).newUsername=s)},null,8,["modelValue"])]),_:1}),n(t,{label:"旧密码",prop:"nowPassword"},{default:a(()=>[n(l,{modelValue:r(e).nowPassword,"onUpdate:modelValue":o[1]||(o[1]=s=>r(e).nowPassword=s)},null,8,["modelValue"])]),_:1}),n(t,{label:"新密码",prop:"newPassword"},{default:a(()=>[n(l,{modelValue:r(e).newPassword,"onUpdate:modelValue":o[2]||(o[2]=s=>r(e).newPassword=s)},null,8,["modelValue"])]),_:1}),n(t,{label:"确认新密码",prop:"confirmPassword"},{default:a(()=>[n(l,{modelValue:r(e).confirmPassword,"onUpdate:modelValue":o[3]||(o[3]=s=>r(e).confirmPassword=s)},null,8,["modelValue"])]),_:1}),n(t,{label:" "},{default:a(()=>[n(U,{type:"primary",onClick:o[4]||(o[4]=s=>c(r(i))),disabled:r(e).pending,loading:r(e).pending},{default:a(()=>[k(" 保存 ")]),_:1},8,["disabled","loading"])]),_:1})]),_:1},8,["model"])}}});export{G as default};
