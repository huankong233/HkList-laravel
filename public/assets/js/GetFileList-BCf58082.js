import{b as J,r as E,N as U,o as K,P as O,E as A,u as W,w as X,e,f as i,c as d,n as r,q as x,t as Y,C as c,l as a,k as R,F as z,x as g,Q as ee,y as te,z as le,A as oe,B as se,p as ae,v as re}from"./.pnpm-BAqWpjXh.js";import{u as ne}from"./fileListStore-9xoCL0eG.js";import{u as ie,a as ue,g as h,c as de}from"./index-upLIL3nz.js";import{c as pe}from"./copy-BEkbu3Ed.js";import{f as me}from"./format-DaCfCw6f.js";import{i as ce}from"./isMobile-BD0f7XPI.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ge=["src"],_e=J({__name:"GetFileList",setup(ve){const V=E("right");ce()&&(V.value="top");const _=ne(),{pending:D,getFileListForm:o,getFileListFormRef:L,selectedRows:N,limitForm:w,limitMessage:b,vcode:v,downloadLinks:T}=U(_),$=ie(),{config:f}=U($),Z=(l,t,n)=>t===""?n(new Error("请先输入需要解析的链接")):F(t)?n():n(new Error("请输入合法的链接")),I=()=>{o.value.dir="/",o.value.surl="";const l=F(o.value.url);l&&(l.id&&(l.surl?(o.value.url=`https://pan.baidu.com/share/init?surl=${l.id}`,o.value.surl=`1${l.id}`):(o.value.url=`https://pan.baidu.com/s/${l.id}`,o.value.surl=l.id)),l.pwd&&(o.value.pwd=l.pwd,A.success("已自动填写密码")))},F=l=>{const t=l.match(/s\/([a-zA-Z0-9_-]+)/),n=l.match(/surl=([a-zA-Z0-9_-]+)/),p=l.match(/\?pwd=([a-zA-Z0-9_-]+)/),u=l.match(/&pwd=([a-zA-Z0-9_-]+)/),m=l.match(/提取码[:：]\s?([a-zA-Z0-9_-]+)/);let y;if(n)y=n[1];else if(t)y=t[1];else return!1;const k=p?p[1]:u?u[1]:m?m[1]:null;return n?{surl:!0,id:y,pwd:k}:{id:y,pwd:k}},P={url:[{required:!0,validator:Z,trigger:"blur"}]},G=async l=>{if(!l||!await l.validate())return;const t=new URLSearchParams;t.set("url",o.value.url),t.set("surl",o.value.surl),t.set("pwd",o.value.pwd),t.set("dir",o.value.dir),pe(`${location.host}/?${t.toString()}`,"复制成功")};K(()=>{O(()=>{const l=new URLSearchParams(location.search);l.size<4||(o.value={url:l.get("url")??"",pwd:l.get("pwd")??"",dir:l.get("dir")??"/",surl:l.get("surl")??""},A.success("已读取到参数,正在加载"),setTimeout(_.getFileList,1e3))}),_.getLimit(),S()});const C=W(),q=()=>C.push("/login"),Q=()=>C.push("/admin"),j=l=>window.open(l),M=E(0),S=()=>M.value=Date.now(),B=()=>T.value=[];return(l,t)=>{const n=ee,p=te,u=le,m=oe,y=se,k=ae,H=re;return X((i(),d(k,null,{default:r(()=>[x("h2",null,"前台解析中心 | "+Y(e(ue)()),1),e(f).show_copyright?(i(),d(n,{key:0,"show-icon":"",type:"warning",closable:!1,title:e(f).custom_copyright},null,8,["title"])):c("",!0),e(f).have_account?(i(),d(n,{key:1,closable:!1,class:"alert",title:"当前中转账号充足",type:"success"})):(i(),d(n,{key:2,closable:!1,class:"alert",title:"当前中转账号不足",type:"error"})),e(f).debug?(i(),d(n,{key:3,class:"alert",title:"当前网站开启了DEBUG模式,非调试请关闭!!!!",type:"error",closable:!1})):c("",!0),e(f).is_https?c("",!0):(i(),d(n,{key:4,class:"alert",title:"当前网站未开启SSL,可能出现无法请求Aria2服务器的问题",type:"error",closable:!1})),a(n,{class:"alert",type:e(b)===""?"success":"error",closable:!1,title:e(b)===""?`当前${e(o).token?"卡密":"用户组"}: ${e(w).group_name} 剩余可解析文件数: ${e(w).count} 剩余可解析大小: ${e(me)(e(w).size)} ${e(o).token?`到期时间: ${e(w).expired_at?new Date(e(w).expired_at).toLocaleString():"未知"}`:""}`:e(b)??"未知错误"},null,8,["type","title"]),a(y,{ref_key:"getFileListFormRef",ref:L,model:e(o),rules:P,"label-width":"auto",class:"form","label-position":V.value},{default:r(()=>[a(u,{label:"链接",prop:"url"},{default:r(()=>[a(p,{modelValue:e(o).url,"onUpdate:modelValue":t[0]||(t[0]=s=>e(o).url=s),modelModifiers:{trim:!0},onChange:t[1]||(t[1]=s=>B()),onBlur:t[2]||(t[2]=s=>I())},null,8,["modelValue"])]),_:1}),a(u,{label:"密码",prop:"pwd"},{default:r(()=>[a(p,{modelValue:e(o).pwd,"onUpdate:modelValue":t[3]||(t[3]=s=>e(o).pwd=s),modelModifiers:{trim:!0},onChange:t[4]||(t[4]=s=>B())},null,8,["modelValue"])]),_:1}),e(f).need_password?(i(),d(u,{key:0,label:"解析密码",prop:"password"},{default:r(()=>[a(p,{modelValue:e(o).password,"onUpdate:modelValue":t[5]||(t[5]=s=>e(o).password=s),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1})):c("",!0),e(f).token_mode?(i(),d(u,{key:1,label:"卡密(不用留空即可)",prop:"token"},{default:r(()=>[a(p,{modelValue:e(o).token,"onUpdate:modelValue":t[6]||(t[6]=s=>e(o).token=s),modelModifiers:{trim:!0},onBlur:e(_).getLimit},null,8,["modelValue","onBlur"])]),_:1})):c("",!0),a(u,{label:"当前路径",prop:"dir"},{default:r(()=>[a(p,{modelValue:e(o).dir,"onUpdate:modelValue":t[7]||(t[7]=s=>e(o).dir=s),disabled:""},null,8,["modelValue"])]),_:1}),e(v).hit_captcha?(i(),R(z,{key:2},[a(u,{label:"验证码编号",prop:"vcode_str"},{default:r(()=>[a(p,{modelValue:e(v).vcode_str,"onUpdate:modelValue":t[8]||(t[8]=s=>e(v).vcode_str=s),disabled:""},null,8,["modelValue"])]),_:1}),a(u,{label:"验证码图片",prop:"vcode_img"},{default:r(()=>[x("img",{src:`${e(v).vcode_img}&t=${M.value}`,alt:"验证码图片",onClick:S},null,8,ge)]),_:1}),a(u,{label:"验证码字符",prop:"vcode_input"},{default:r(()=>[a(p,{modelValue:e(v).vcode_input,"onUpdate:modelValue":t[9]||(t[9]=s=>e(v).vcode_input=s)},null,8,["modelValue"])]),_:1})],64)):c("",!0),a(u,{label:" ",class:"buttons"},{default:r(()=>[a(m,{type:"primary",onClick:t[10]||(t[10]=s=>e(_).getFileList())},{default:r(()=>[g("获取/刷新列表")]),_:1}),a(m,{type:"primary",disabled:e(N).length<=0,onClick:t[11]||(t[11]=s=>e(_).getDownloadLinks())},{default:r(()=>[g(" 批量解析 ")]),_:1},8,["disabled"]),a(m,{type:"primary",onClick:t[12]||(t[12]=s=>G(e(L)))},{default:r(()=>[g("复制当前地址")]),_:1}),e(f).button_link!==""?(i(),d(m,{key:0,type:"primary",onClick:t[13]||(t[13]=s=>j(e(f).button_link))},{default:r(()=>[g(" 前往购买卡密 ")]),_:1})):c("",!0),e(h)()==="0"?(i(),d(m,{key:1,type:"primary",onClick:t[14]||(t[14]=s=>q())},{default:r(()=>[g("登陆")]),_:1})):c("",!0),e(h)()==="1"?(i(),R(z,{key:2},[e(de)()==="admin"?(i(),d(m,{key:0,type:"primary",onClick:t[15]||(t[15]=s=>Q())},{default:r(()=>[g(" 进入后台 ")]),_:1})):c("",!0),a(m,{type:"danger",onClick:t[16]||(t[16]=s=>e($).logout())},{default:r(()=>[g(" 注销 ")]),_:1})],64)):c("",!0)]),_:1})]),_:1},8,["model","label-position"])]),_:1})),[[H,e(D)]])}}}),Fe=fe(_e,[["__scopeId","data-v-e9367d23"]]);export{Fe as default};
