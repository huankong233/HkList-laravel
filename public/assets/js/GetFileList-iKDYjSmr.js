import{u as z}from"./fileListStore-DfbFNb5k.js";import{u as A,a as P,g as B,c as Z}from"./index-BAVvJDkb.js";import{c as G}from"./copy-DyHnEpWH.js";import{f as x}from"./format-DaCfCw6f.js";import{i as I}from"./isMobile-BD0f7XPI.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css              */const j={key:0},H={key:1},J=["src"],K=Vue.defineComponent({__name:"GetFileList",setup(O){const f=Vue.ref("right");I()&&(f.value="top");const i=z(),{pending:b,getFileListForm:u,getFileListFormRef:k,selectedRows:h,limitForm:V,limitMessage:g,vcode:d,downloadLinks:L}=Pinia.storeToRefs(i),w=A(),{config:s}=Pinia.storeToRefs(w),S=(t,e,l)=>e===""?l(new Error("请先输入需要解析的链接")):v(e)?l():l(new Error("请输入合法的链接")),E=()=>{u.value.dir="/",u.value.surl="";const t=v(u.value.url);t&&(t.id&&(t.surl?(u.value.url=`https://pan.baidu.com/share/init?surl=${t.id}`,u.value.surl=`1${t.id}`):(u.value.url=`https://pan.baidu.com/s/${t.id}`,u.value.surl=t.id)),t.pwd&&(u.value.pwd=t.pwd,ElementPlus.ElMessage.success("已自动填写密码")))},v=t=>{const e=t.match(/s\/([a-zA-Z0-9_-]+)/),l=t.match(/surl=([a-zA-Z0-9_-]+)/),n=t.match(/\?pwd=([a-zA-Z0-9_-]+)/),r=t.match(/&pwd=([a-zA-Z0-9_-]+)/),a=t.match(/提取码[:：]\s?([a-zA-Z0-9_-]+)/);let c;if(l)c=l[1];else if(e)c=e[1];else return!1;const p=n?n[1]:r?r[1]:a?a[1]:null;return l?{surl:!0,id:c,pwd:p}:{id:c,pwd:p}},$={url:[{required:!0,validator:S,trigger:"blur"}]},F=async t=>{if(!t||!await t.validate())return;const e=new URLSearchParams;e.set("url",u.value.url),e.set("surl",u.value.surl),e.set("pwd",u.value.pwd),e.set("dir",u.value.dir),G(`${location.host}/?${e.toString()}`,"复制成功")};Vue.onMounted(()=>{Vue.nextTick(()=>{const t=new URLSearchParams(location.search);if(t.size<4)return;const e=t.get("url"),l=t.get("pwd"),n=t.get("dir"),r=t.get("surl");!e||!l||!n||!r||(u.value={url:e,pwd:l,dir:n,surl:r},ElementPlus.ElMessage.success("已读取到参数,正在加载"),setTimeout(i.getFileList,500))}),i.getLimit(),C()});const _=VueRouter.useRouter(),D=()=>_.push("/login"),M=()=>_.push("/admin"),T=t=>window.open(t),y=Vue.ref(0),C=()=>y.value=Date.now(),N=()=>L.value=[],m=Vue.ref(!1),R=()=>{u.value.token!==""?m.value=!0:m.value=!1,i.getLimit()};return(t,e)=>{const l=Vue.resolveComponent("el-alert"),n=Vue.resolveComponent("el-input"),r=Vue.resolveComponent("el-form-item"),a=Vue.resolveComponent("el-button"),c=Vue.resolveComponent("el-form"),p=Vue.resolveComponent("el-card"),U=Vue.resolveDirective("loading");return Vue.withDirectives((Vue.openBlock(),Vue.createBlock(p,null,{default:Vue.withCtx(()=>[Vue.createElementVNode("h2",null,"前台解析中心 | "+Vue.toDisplayString(Vue.unref(P)()),1),Vue.unref(s).show_copyright?(Vue.openBlock(),Vue.createBlock(l,{key:0,"show-icon":"",type:"warning",closable:!1,title:Vue.unref(s).custom_copyright},null,8,["title"])):Vue.createCommentVNode("",!0),Vue.unref(s).have_account?(Vue.openBlock(),Vue.createBlock(l,{key:1,closable:!1,class:"alert",title:"当前中转账号充足",type:"success"})):(Vue.openBlock(),Vue.createBlock(l,{key:2,closable:!1,class:"alert",title:"当前中转账号不足",type:"error"})),Vue.unref(s).debug?(Vue.openBlock(),Vue.createBlock(l,{key:3,class:"alert",title:"当前网站开启了DEBUG模式,非调试请关闭!!!!",type:"error",closable:!1})):Vue.createCommentVNode("",!0),Vue.unref(s).is_https?Vue.createCommentVNode("",!0):(Vue.openBlock(),Vue.createBlock(l,{key:4,class:"alert",title:"当前网站未开启SSL,可能出现无法请求Aria2服务器的问题",type:"error",closable:!1})),Vue.unref(g)===""?(Vue.openBlock(),Vue.createBlock(l,{key:5,class:"alert",type:"success",closable:!1},{default:Vue.withCtx(()=>[m.value?(Vue.openBlock(),Vue.createElementBlock("span",j,[Vue.createElementVNode("span",null,"当前卡密: "+Vue.toDisplayString(Vue.unref(V).group_name),1),Vue.createElementVNode("span",null,"剩余可解析文件数: "+Vue.toDisplayString(Vue.unref(V).count),1),Vue.createElementVNode("span",null,"剩余可解析大小: "+Vue.toDisplayString(Vue.unref(x)(Vue.unref(V).size)),1),Vue.createElementVNode("span",null," 到期时间: "+Vue.toDisplayString(Vue.unref(V).expired_at==="未使用"?Vue.unref(V).expired_at:new Date(Vue.unref(V).expired_at??0).toLocaleString()),1)])):(Vue.openBlock(),Vue.createElementBlock("span",H,[Vue.createElementVNode("span",null,"当前用户组: "+Vue.toDisplayString(Vue.unref(V).group_name),1),Vue.createElementVNode("span",null,"剩余可解析文件数: "+Vue.toDisplayString(Vue.unref(V).count),1),Vue.createElementVNode("span",null,"剩余可解析大小: "+Vue.toDisplayString(Vue.unref(x)(Vue.unref(V).size)),1)]))]),_:1})):(Vue.openBlock(),Vue.createBlock(l,{key:6,class:"alert",type:"error",closable:!1},{default:Vue.withCtx(()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(g)??"未知错误"),1)]),_:1})),Vue.createVNode(c,{ref_key:"getFileListFormRef",ref:k,model:Vue.unref(u),rules:$,"label-width":"auto",class:"form","label-position":f.value},{default:Vue.withCtx(()=>[Vue.createVNode(r,{label:"链接",prop:"url"},{default:Vue.withCtx(()=>[Vue.createVNode(n,{modelValue:Vue.unref(u).url,"onUpdate:modelValue":e[0]||(e[0]=o=>Vue.unref(u).url=o),modelModifiers:{trim:!0},onChange:e[1]||(e[1]=o=>N()),onBlur:e[2]||(e[2]=o=>E())},null,8,["modelValue"])]),_:1}),Vue.createVNode(r,{label:"密码",prop:"pwd"},{default:Vue.withCtx(()=>[Vue.createVNode(n,{modelValue:Vue.unref(u).pwd,"onUpdate:modelValue":e[3]||(e[3]=o=>Vue.unref(u).pwd=o),modelModifiers:{trim:!0},onChange:e[4]||(e[4]=o=>N())},null,8,["modelValue"])]),_:1}),Vue.unref(s).need_password?(Vue.openBlock(),Vue.createBlock(r,{key:0,label:"解析密码",prop:"password"},{default:Vue.withCtx(()=>[Vue.createVNode(n,{modelValue:Vue.unref(u).password,"onUpdate:modelValue":e[5]||(e[5]=o=>Vue.unref(u).password=o),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1})):Vue.createCommentVNode("",!0),Vue.unref(s).token_mode?(Vue.openBlock(),Vue.createBlock(r,{key:1,label:"卡密(不用留空即可)",prop:"token"},{default:Vue.withCtx(()=>[Vue.createVNode(n,{modelValue:Vue.unref(u).token,"onUpdate:modelValue":e[6]||(e[6]=o=>Vue.unref(u).token=o),modelModifiers:{trim:!0},onBlur:R},null,8,["modelValue"])]),_:1})):Vue.createCommentVNode("",!0),Vue.createVNode(r,{label:"当前路径",prop:"dir"},{default:Vue.withCtx(()=>[Vue.createVNode(n,{modelValue:Vue.unref(u).dir,"onUpdate:modelValue":e[7]||(e[7]=o=>Vue.unref(u).dir=o),disabled:""},null,8,["modelValue"])]),_:1}),Vue.unref(d).hit_captcha?(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,{key:2},[Vue.createVNode(r,{label:"验证码编号",prop:"vcode_str"},{default:Vue.withCtx(()=>[Vue.createVNode(n,{modelValue:Vue.unref(d).vcode_str,"onUpdate:modelValue":e[8]||(e[8]=o=>Vue.unref(d).vcode_str=o),disabled:""},null,8,["modelValue"])]),_:1}),Vue.createVNode(r,{label:"验证码图片",prop:"vcode_img"},{default:Vue.withCtx(()=>[Vue.createElementVNode("img",{src:`${Vue.unref(d).vcode_img}&t=${y.value}`,alt:"验证码图片",onClick:C},null,8,J)]),_:1}),Vue.createVNode(r,{label:"验证码字符",prop:"vcode_input"},{default:Vue.withCtx(()=>[Vue.createVNode(n,{modelValue:Vue.unref(d).vcode_input,"onUpdate:modelValue":e[9]||(e[9]=o=>Vue.unref(d).vcode_input=o)},null,8,["modelValue"])]),_:1})],64)):Vue.createCommentVNode("",!0),Vue.createVNode(r,{label:" ",class:"buttons"},{default:Vue.withCtx(()=>[Vue.createVNode(a,{type:"primary",onClick:e[10]||(e[10]=o=>Vue.unref(i).getFileList())},{default:Vue.withCtx(()=>[Vue.createTextVNode("获取/刷新列表")]),_:1}),Vue.createVNode(a,{type:"primary",disabled:Vue.unref(h).length<=0,onClick:e[11]||(e[11]=o=>Vue.unref(i).getDownloadLinks())},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 批量解析 ")]),_:1},8,["disabled"]),Vue.createVNode(a,{type:"primary",onClick:e[12]||(e[12]=o=>F(Vue.unref(k)))},{default:Vue.withCtx(()=>[Vue.createTextVNode("复制当前地址")]),_:1}),Vue.unref(s).button_link!==""?(Vue.openBlock(),Vue.createBlock(a,{key:0,type:"primary",onClick:e[13]||(e[13]=o=>T(Vue.unref(s).button_link))},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 前往购买卡密 ")]),_:1})):Vue.createCommentVNode("",!0),Vue.unref(B)()==="0"?(Vue.openBlock(),Vue.createBlock(a,{key:1,type:"primary",onClick:e[14]||(e[14]=o=>D())},{default:Vue.withCtx(()=>[Vue.createTextVNode("登陆")]),_:1})):Vue.createCommentVNode("",!0),Vue.unref(B)()==="1"?(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,{key:2},[Vue.unref(Z)()==="admin"?(Vue.openBlock(),Vue.createBlock(a,{key:0,type:"primary",onClick:e[15]||(e[15]=o=>M())},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 进入后台 ")]),_:1})):Vue.createCommentVNode("",!0),Vue.createVNode(a,{type:"danger",onClick:e[16]||(e[16]=o=>Vue.unref(w).logout())},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 注销 ")]),_:1})],64)):Vue.createCommentVNode("",!0)]),_:1})]),_:1},8,["model","label-position"])]),_:1})),[[U,Vue.unref(b)]])}}}),oe=q(K,[["__scopeId","data-v-54e35db6"]]);export{oe as default};
