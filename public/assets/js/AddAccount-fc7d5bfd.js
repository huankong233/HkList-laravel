import"./base-e8db4a9d.js";import{E as b}from"./el-overlay-7435f68f.js";import{E as V}from"./el-button-21ff238e.js";import{E as w,a as E}from"./el-form-item-77bf1366.js";import{E as I}from"./el-input-e0bc9846.js";import{a as T,m as C,e as F,R as M,w as l,b as n,u as t,q as c,a1 as P}from"./index-607dfe2f.js";import{u as R}from"./AccountManagement-200fc13a.js";import{j as x,c as S}from"./admin-f9a97a86.js";import{E as U}from"./request-70b65b72.js";import"./vnode-cd43b426.js";import"./focus-trap-9634570e.js";import"./isNil-c75b1b34.js";import"./scroll-f050c522.js";import"./index-53bf12df.js";import"./use-form-item-1a794399.js";import"./_initCloneObject-b85b73ba.js";const Z=T({__name:"AddAccount",setup($){const r=R(),{addAccountForm:e,addAccountFormRef:u,addAccountFormVisible:s}=C(r),f=()=>{e.value.checkedInfo=!1,e.value.username="",e.value.vipType=""},v=async i=>{if(!i||!await i.validate(()=>{}))return;e.value.addPending=!0;let o;try{o=await x({cookie:e.value.cookie})}catch{f(),o="failed"}e.value.addPending=!1,o.toString()!=="failed"&&(r.closeAddDialog(),await r.getAccounts(),U.success("添加成功"))},g={cookie:[{required:!0,message:"请输入账户Cookie",trigger:"blur"}]},k=new Map([[0,"普通用户"],[1,"普通会员"],[2,"超级会员"]]),_=async i=>{if(!i||!await i.validate(()=>{}))return;e.value.checkPending=!0;const o=await S({cookie:e.value.cookie})??"failed";if(e.value.checkPending=!1,o.toString()==="failed")return;const{data:d}=o;e.value.checkedInfo=!0,e.value.username=d.baidu_name,e.value.vipType=k.get(d.vip_type)??"普通用户"};return(i,o)=>{const d=I,m=w,y=E,p=V,A=b;return F(),M(A,{modelValue:t(s),"onUpdate:modelValue":o[7]||(o[7]=a=>P(s)?s.value=a:null),title:"添加代理账号",width:"60%"},{footer:l(()=>[n(p,{type:"info",onClick:o[4]||(o[4]=a=>t(r).closeAddDialog())},{default:l(()=>[c("取消")]),_:1}),n(p,{type:"primary",onClick:o[5]||(o[5]=a=>_(t(u))),disabled:t(e).checkedInfo,loading:t(e).checkPending},{default:l(()=>[c(" 获取账户信息 ")]),_:1},8,["disabled","loading"]),n(p,{type:"primary",onClick:o[6]||(o[6]=a=>v(t(u))),disabled:!t(e).checkedInfo,loading:t(e).addPending},{default:l(()=>[c(" 添加 ")]),_:1},8,["disabled","loading"])]),default:l(()=>[n(y,{ref_key:"addAccountFormRef",ref:u,model:t(e),rules:g,"label-width":"auto"},{default:l(()=>[n(m,{label:"账户Cookie",prop:"cookie"},{default:l(()=>[n(d,{type:"textarea",modelValue:t(e).cookie,"onUpdate:modelValue":o[0]||(o[0]=a=>t(e).cookie=a),modelModifiers:{trim:!0},rows:"5",onInput:o[1]||(o[1]=a=>f())},null,8,["modelValue"])]),_:1}),n(m,{label:"账号名称",prop:"username"},{default:l(()=>[n(d,{modelValue:t(e).username,"onUpdate:modelValue":o[2]||(o[2]=a=>t(e).username=a),disabled:""},null,8,["modelValue"])]),_:1}),n(m,{label:"账号等级",prop:"vipType"},{default:l(()=>[n(d,{modelValue:t(e).vipType,"onUpdate:modelValue":o[3]||(o[3]=a=>t(e).vipType=a),disabled:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}});export{Z as default};
