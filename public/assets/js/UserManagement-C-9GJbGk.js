import{E as x,b as j,c as ee,i as H,j as K,e as ae,d as J,k as le,v as Q,m as te,o as oe,s as se}from"./element-plus@2.7.7_vue@3.4.32_typescript@5.5.3_-4orX1JGZ.js";import{v as E}from"./@vue_runtime-dom@3.4.32-DNdjNMzo.js";import{i as M}from"./index-DYV93AZk.js";import{d as W,_ as ne,$ as de,o as V,G as S,H as l,i as a,L as _,I as U,c as A,F as N,R as X,m as ue,a as C,K as T}from"./@vue_runtime-core@3.4.32-BofAHbgu.js";import{r as f,u as q}from"./@vue_reactivity@3.4.32-DksAu7zd.js";import{f as G}from"./format-CyW-QbYa.js";import{L as i}from"./@vue_shared@3.4.32-CaCWPAm8.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./lodash-es@4.17.21-BB-zMWwC.js";import"./async-validator@4.2.5-DKvM95Vc.js";import"./@vueuse_core@9.13.0_vue@3.4.32_typescript@5.5.3_-DkVRVfGD.js";import"./@vueuse_shared@9.13.0_vue@3.4.32_typescript@5.5.3_-BbpdFR9m.js";import"./dayjs@1.11.11-Ct2Knyoi.js";import"./@element-plus_icons-vue@2.3.1_vue@3.4.32_typescript@5.5.3_-x2o2c_8n.js";import"./@ctrl_tinycolor@3.6.1-r5W6hzzQ.js";import"./@sxzz_popperjs-es@2.11.7-D9SI2xQl.js";import"./normalize-wheel-es@1.2.0-B6fDCfyv.js";import"./pinia@2.1.7_typescript@5.5.3_vue@3.4.32_typescript@5.5.3_-BSzeUtha.js";import"./vue-demi@0.14.8_vue@3.4.32_typescript@5.5.3_-Dq6ymT-8.js";import"./axios@1.7.2-B4uVmeYG.js";import"./@fingerprintjs_fingerprintjs@4.5.1-5RNCfJbQ.js";import"./tslib@2.6.3-CPxunF3b.js";import"./vue-router@4.4.0_vue@3.4.32_typescript@5.5.3_-ByijA4Eg.js";const ie=u=>M.post("/admin/user",u),pe=u=>M.get(`/admin/user?page=${u.page}&size=${u.size}`),me=u=>M.patch(`/admin/user/${u.id}`,u),ce=u=>M.delete("/admin/user",{data:{user_ids:[u.id]}}),_e=u=>M.delete("/admin/user",{data:{user_ids:u}}),fe=W({__name:"AddUser",props:{modelValue:{},modelModifiers:{}},emits:ne(["getUsers"],["update:modelValue"]),setup(u,{emit:m}){const z=m,b=de(u,"modelValue"),v=f(!1),r=f({username:"",password:"",role:"user",inv_code_id:1}),c=f(null),F={username:[{required:!0,message:"请输入账户用户名",trigger:"blur"}],password:[{required:!0,message:"请输入账户密码",trigger:"blur"}]},D=async k=>{if(!(!k||!await k.validate()))try{v.value=!0,await ie(r.value),x.success("添加成功")}finally{v.value=!1}},L=k=>{z("getUsers"),k()},B=()=>{b.value=!1,z("getUsers")};return(k,s)=>{const g=j,$=ee,t=H,n=K,y=ae,d=J,w=le,I=Q;return V(),S(w,{title:"添加用户",width:"60%",modelValue:b.value,"onUpdate:modelValue":s[6]||(s[6]=o=>b.value=o),"before-close":L},{footer:l(()=>[a(d,{type:"info",onClick:s[4]||(s[4]=o=>B())},{default:l(()=>[_("取消")]),_:1}),a(d,{type:"primary",onClick:s[5]||(s[5]=o=>D(c.value))},{default:l(()=>[_("添加")]),_:1})]),default:l(()=>[U((V(),S(y,{ref_key:"addUserFormRef",ref:c,model:r.value,rules:F,"label-width":"auto"},{default:l(()=>[a($,{label:"用户名",prop:"username"},{default:l(()=>[a(g,{modelValue:r.value.username,"onUpdate:modelValue":s[0]||(s[0]=o=>r.value.username=o)},null,8,["modelValue"])]),_:1}),a($,{label:"密码",prop:"password"},{default:l(()=>[a(g,{modelValue:r.value.password,"onUpdate:modelValue":s[1]||(s[1]=o=>r.value.password=o)},null,8,["modelValue"])]),_:1}),a($,{label:"权限",prop:"role"},{default:l(()=>[a(n,{modelValue:r.value.role,"onUpdate:modelValue":s[2]||(s[2]=o=>r.value.role=o)},{default:l(()=>[(V(),A(N,null,X(["user","admin"],o=>a(t,{key:o,label:o,value:o},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a($,{label:"邀请码ID",prop:"inv_code_id"},{default:l(()=>[a(g,{modelValue:r.value.inv_code_id,"onUpdate:modelValue":s[3]||(s[3]=o=>r.value.inv_code_id=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[I,v.value]])]),_:1},8,["modelValue"])}}}),ve=W({__name:"UserManagement",setup(u){const m=f(!1),z=f(15),b=f(1),v=f(),r=f([]),c=async()=>{try{m.value=!0;const t=await pe({page:b.value,size:z.value});v.value=t.data}finally{m.value=!1}},F=async t=>{t.edit=!(t.edit??!1)},D=async t=>{t.edit=!(t.edit??!0),await L(t)},L=async t=>{try{m.value=!0,await me(t),x.success("修改用户成功")}finally{m.value=!1,await c()}},B=async t=>{try{m.value=!0,await ce(t),x.success("删除用户成功")}finally{m.value=!1,await c()}},k=async()=>{try{m.value=!0;const t=r.value.map(n=>n.id);await _e(t),x.success("批量删除用户成功")}finally{m.value=!1,await c()}},s=t=>r.value=t;ue(c);const g=f(!1),$=()=>g.value=!g.value;return(t,n)=>{var R,O,P;const y=J,d=te,w=j,I=H,o=K,Y=oe,Z=se,h=Q;return V(),A(N,null,[a(fe,{onGetUsers:c,modelValue:g.value,"onUpdate:modelValue":n[0]||(n[0]=e=>g.value=e)},null,8,["modelValue"]),a(y,{type:"primary",onClick:n[1]||(n[1]=e=>c())},{default:l(()=>[_("刷新列表")]),_:1}),a(y,{type:"primary",onClick:n[2]||(n[2]=e=>$())},{default:l(()=>[_("添加用户")]),_:1}),a(y,{type:"danger",disabled:r.value.length<=0,onClick:n[3]||(n[3]=e=>k())},{default:l(()=>[_(" 批量删除 ")]),_:1},8,["disabled"]),U((V(),S(Y,{data:((R=v.value)==null?void 0:R.data)??[],border:"","show-overflow-tooltip":"",class:"table",onSelectionChange:s},{default:l(()=>[a(d,{type:"selection",width:"40"}),a(d,{prop:"id",label:"ID"}),a(d,{prop:"",label:"用户组"},{default:l(({row:e})=>[C("span",null,i(e.group.id)+" ("+i(e.group.name)+")",1)]),_:1}),a(d,{prop:"inv_code.name",label:"邀请码"},{default:l(({row:e})=>[C("span",null,i(e.inv_code.id)+" ("+i(e.inv_code.name)+")",1)]),_:1}),a(d,{prop:"today_size",label:"今日解析"},{default:l(({row:e})=>[C("span",null,i(e.today_count)+" ("+i(q(G)(e.today_size??0))+")",1)]),_:1}),a(d,{prop:"today_size",label:"縂共解析"},{default:l(({row:e})=>[C("span",null,i(e.total_count)+" ("+i(q(G)(e.total_size??0))+")",1)]),_:1}),a(d,{prop:"username",label:"用户名"},{default:l(({row:e})=>[U(C("span",null,i(e.username),513),[[E,!e.edit]]),U(a(w,{modelValue:e.username,"onUpdate:modelValue":p=>e.username=p},null,8,["modelValue","onUpdate:modelValue"]),[[E,e.edit]])]),_:1}),a(d,{prop:"password",label:"密码"},{default:l(({row:e})=>[U(C("span",null,i(e.password),513),[[E,!e.edit]]),U(a(w,{modelValue:e.password,"onUpdate:modelValue":p=>e.password=p},null,8,["modelValue","onUpdate:modelValue"]),[[E,e.edit]])]),_:1}),a(d,{prop:"role",label:"权限"},{default:l(({row:e})=>[U(C("span",null,i(e.role),513),[[E,!e.edit]]),U(a(o,{modelValue:e.role,"onUpdate:modelValue":p=>e.role=p},{default:l(()=>[(V(),A(N,null,X(["user","admin"],p=>a(I,{key:p,label:p,value:p},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"]),[[E,e.edit]])]),_:1}),a(d,{prop:"created_at",label:"创建时间"},{default:l(({row:e})=>[_(i(new Date(e.created_at).toLocaleString()),1)]),_:1}),a(d,{prop:"updated_at",label:"更新时间"},{default:l(({row:e})=>[_(i(new Date(e.updated_at).toLocaleString()),1)]),_:1}),a(d,{width:"150",label:"操作",fixed:"right"},{default:l(({row:e})=>[e.edit?T("",!0):(V(),S(y,{key:0,size:"small",type:"primary",onClick:p=>F(e)},{default:l(()=>[_(" 编辑 ")]),_:2},1032,["onClick"])),e.edit?(V(),S(y,{key:1,size:"small",type:"primary",onClick:p=>D(e)},{default:l(()=>[_(" 保存 ")]),_:2},1032,["onClick"])):T("",!0),a(y,{size:"small",type:"danger",onClick:p=>B(e)},{default:l(()=>[_("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[h,m.value]]),a(Z,{"current-page":b.value,"onUpdate:currentPage":n[4]||(n[4]=e=>b.value=e),"page-size":z.value,"onUpdate:pageSize":n[5]||(n[5]=e=>z.value=e),"page-sizes":[15,50,100,500,((O=v.value)==null?void 0:O.total)??100],total:((P=v.value)==null?void 0:P.total)??100,layout:"sizes, prev, pager, next",onSizeChange:c,onCurrentChange:c},null,8,["current-page","page-size","page-sizes","total"])],64)}}}),Pe=re(ve,[["__scopeId","data-v-39a05d3b"]]);export{Pe as default};
