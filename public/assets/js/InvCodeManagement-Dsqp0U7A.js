import{E as x,i as Y,j as Z,c as h,r as P,b as T,e as ee,d as G,k as te,v as H,m as ae,o as le,s as ne}from"./element-plus@2.7.7_vue@3.4.32_typescript@5.5.3_-4orX1JGZ.js";import{v as z}from"./@vue_runtime-dom@3.4.32-DNdjNMzo.js";import{i as E}from"./index-DYV93AZk.js";import{d as K,_ as oe,$ as de,o as g,G as I,H as l,i as t,L as p,I as C,c as J,F as Q,R as ue,m as se,a as N,K as O}from"./@vue_runtime-core@3.4.32-BofAHbgu.js";import{r as _,u as ie}from"./@vue_reactivity@3.4.32-DksAu7zd.js";import{c as R}from"./copy-By2guqEs.js";import{L as U}from"./@vue_shared@3.4.32-CaCWPAm8.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./lodash-es@4.17.21-BB-zMWwC.js";import"./async-validator@4.2.5-DKvM95Vc.js";import"./@vueuse_core@9.13.0_vue@3.4.32_typescript@5.5.3_-DkVRVfGD.js";import"./@vueuse_shared@9.13.0_vue@3.4.32_typescript@5.5.3_-BbpdFR9m.js";import"./dayjs@1.11.11-Ct2Knyoi.js";import"./@element-plus_icons-vue@2.3.1_vue@3.4.32_typescript@5.5.3_-x2o2c_8n.js";import"./@ctrl_tinycolor@3.6.1-r5W6hzzQ.js";import"./@sxzz_popperjs-es@2.11.7-D9SI2xQl.js";import"./normalize-wheel-es@1.2.0-B6fDCfyv.js";import"./pinia@2.1.7_typescript@5.5.3_vue@3.4.32_typescript@5.5.3_-BSzeUtha.js";import"./vue-demi@0.14.8_vue@3.4.32_typescript@5.5.3_-Dq6ymT-8.js";import"./axios@1.7.2-B4uVmeYG.js";import"./@fingerprintjs_fingerprintjs@4.5.1-5RNCfJbQ.js";import"./tslib@2.6.3-CPxunF3b.js";import"./vue-router@4.4.0_vue@3.4.32_typescript@5.5.3_-ByijA4Eg.js";const re=i=>E.post("/admin/inv_code",i),me=i=>E.post("/admin/inv_code/generate",i),ce=i=>E.get(`/admin/inv_code?page=${i.page}&size=${i.size}`),ve=i=>E.patch(`/admin/inv_code/${i.id}`,i),_e=i=>E.delete("/admin/inv_code",{data:{inv_code_ids:[i.id]}}),ge=i=>E.delete("/admin/inv_code",{data:{inv_code_ids:i}}),fe=K({__name:"AddInvCode",props:{modelValue:{},modelModifiers:{}},emits:oe(["getInvCodes"],["update:modelValue"]),setup(i,{emit:m}){const k=m,V=de(i,"modelValue"),f=_(!1),a=_({type:"single",group_id:2,name:"",can_count:10}),c=_(null),D={group_id:[{required:!0,message:"请输入邀请码用户组ID",trigger:"blur"}],name:[{required:!0,message:"请输入邀请码名称",trigger:"blur"}],can_count:[{required:!0,message:"请输入可注册次数",trigger:"blur"}],count:[{required:!0,message:"请输入邀请码个数",trigger:"blur"}]},M=async b=>{if(!(!b||!await b.validate()))try{f.value=!0,a.value.type==="single"?await re({type:"single",name:a.value.name,can_count:a.value.can_count,group_id:a.value.group_id}):await me({type:"random",count:a.value.count,can_count:a.value.can_count,group_id:a.value.group_id}),x.success("添加成功")}finally{f.value=!1}},F=b=>{k("getInvCodes"),b()},L=()=>{V.value=!1,k("getInvCodes")};return(b,u)=>{const $=Y,j=Z,y=h,n=P,o=T,s=ee,r=G,B=te,S=H;return g(),I(B,{title:"添加邀请码",width:"60%",modelValue:V.value,"onUpdate:modelValue":u[7]||(u[7]=d=>V.value=d),"before-close":F},{footer:l(()=>[t(r,{type:"info",onClick:u[5]||(u[5]=d=>L())},{default:l(()=>[p("取消")]),_:1}),t(r,{type:"primary",onClick:u[6]||(u[6]=d=>M(c.value))},{default:l(()=>[p("添加")]),_:1})]),default:l(()=>[C((g(),I(s,{ref_key:"addInvCodeFormRef",ref:c,model:a.value,rules:D,"label-width":"auto"},{default:l(()=>[t(y,{label:"创建方式",prop:"type"},{default:l(()=>[t(j,{modelValue:a.value.type,"onUpdate:modelValue":u[0]||(u[0]=d=>a.value.type=d)},{default:l(()=>[(g(),J(Q,null,ue(["single","random"],d=>t($,{key:d,label:d,value:d},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(y,{label:"可用次数",prop:"can_count"},{default:l(()=>[t(n,{modelValue:a.value.can_count,"onUpdate:modelValue":u[1]||(u[1]=d=>a.value.can_count=d)},null,8,["modelValue"])]),_:1}),t(y,{label:"用户组ID",prop:"group_id"},{default:l(()=>[t(n,{modelValue:a.value.group_id,"onUpdate:modelValue":u[2]||(u[2]=d=>a.value.group_id=d)},null,8,["modelValue"])]),_:1}),a.value.type==="single"?(g(),I(y,{key:0,label:"邀请码名称",prop:"name"},{default:l(()=>[t(o,{modelValue:a.value.name,"onUpdate:modelValue":u[3]||(u[3]=d=>a.value.name=d)},null,8,["modelValue"])]),_:1})):(g(),I(y,{key:1,label:"邀请码个数",prop:"count"},{default:l(()=>[t(n,{modelValue:a.value.count,"onUpdate:modelValue":u[4]||(u[4]=d=>a.value.count=d)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])),[[S,f.value]])]),_:1},8,["modelValue"])}}}),ye=K({__name:"InvCodeManagement",setup(i){const m=_(!1),k=_(15),V=_(1),f=_(),a=_([]),c=async()=>{try{m.value=!0;const n=await ce({page:V.value,size:k.value});f.value=n.data}finally{m.value=!1}},D=async n=>{n.edit=!(n.edit??!1)},M=async n=>{n.edit=!(n.edit??!0),await F(n)},F=async n=>{try{m.value=!0,await ve(n),x.success("修改邀请码成功")}finally{m.value=!1,await c()}},L=async n=>{try{m.value=!0,await _e(n),x.success("删除邀请码成功")}finally{m.value=!1,await c()}},b=async()=>{try{m.value=!0;const n=a.value.map(o=>o.id);await ge(n),x.success("删除邀请码成功")}finally{m.value=!1,await c()}},u=n=>a.value=n;se(c);const $=_(!1),j=()=>$.value=!$.value,y=(n=!0)=>{if(!n){R(a.value.map(s=>s.name).join(`
`));return}const o=a.value.map(s=>[s.name,s.group.count,s.group.size].join(" | "));o.unshift(["邀请码","可用次数","可下载量"].join(" | ")),R(o.join(`
`))};return(n,o)=>{var q,A,w;const s=G,r=ae,B=T,S=P,d=le,W=ne,X=H;return g(),J(Q,null,[t(fe,{onGetInvCodes:c,modelValue:$.value,"onUpdate:modelValue":o[0]||(o[0]=e=>$.value=e)},null,8,["modelValue"]),t(s,{type:"primary",onClick:o[1]||(o[1]=e=>c())},{default:l(()=>[p("刷新列表")]),_:1}),t(s,{type:"primary",onClick:o[2]||(o[2]=e=>j())},{default:l(()=>[p("添加邀请码")]),_:1}),t(s,{type:"primary",disabled:a.value.length<=0,onClick:o[3]||(o[3]=e=>y())},{default:l(()=>[p(" 批量复制 ")]),_:1},8,["disabled"]),t(s,{type:"primary",disabled:a.value.length<=0,onClick:o[4]||(o[4]=e=>y())},{default:l(()=>[p(" 批量复制(无格式) ")]),_:1},8,["disabled"]),t(s,{type:"danger",disabled:a.value.length<=0,onClick:o[5]||(o[5]=e=>b())},{default:l(()=>[p(" 批量删除 ")]),_:1},8,["disabled"]),C((g(),I(d,{data:((q=f.value)==null?void 0:q.data)??[],border:"","show-overflow-tooltip":"",class:"table",onSelectionChange:u},{default:l(()=>[t(r,{type:"selection",width:"40"}),t(r,{prop:"id",label:"ID"}),t(r,{prop:"name",label:"邀请码名称"},{default:l(({row:e})=>[C(N("span",null,U(e.name),513),[[z,!e.edit]]),C(t(B,{modelValue:e.name,"onUpdate:modelValue":v=>e.name=v},null,8,["modelValue","onUpdate:modelValue"]),[[z,e.edit]])]),_:1}),t(r,{prop:"group_id",label:"用户组ID"},{default:l(({row:e})=>[C(N("span",null,U(e.group_id),513),[[z,!e.edit]]),C(t(S,{modelValue:e.group_id,"onUpdate:modelValue":v=>e.group_id=v},null,8,["modelValue","onUpdate:modelValue"]),[[z,e.edit]])]),_:1}),t(r,{prop:"can_count",label:"可用次数"},{default:l(({row:e})=>[C(N("span",null,U(e.can_count),513),[[z,!e.edit]]),C(t(S,{modelValue:e.can_count,"onUpdate:modelValue":v=>e.can_count=v},null,8,["modelValue","onUpdate:modelValue"]),[[z,e.edit]])]),_:1}),t(r,{prop:"use_count",label:"已使用次数"}),t(r,{prop:"created_at",label:"创建时间"},{default:l(({row:e})=>[p(U(new Date(e.created_at).toLocaleString()),1)]),_:1}),t(r,{prop:"updated_at",label:"更新时间"},{default:l(({row:e})=>[p(U(new Date(e.updated_at).toLocaleString()),1)]),_:1}),t(r,{width:"200",label:"操作",fixed:"right"},{default:l(({row:e})=>[e.edit?O("",!0):(g(),I(s,{key:0,size:"small",type:"primary",onClick:v=>D(e)},{default:l(()=>[p(" 编辑 ")]),_:2},1032,["onClick"])),e.edit?(g(),I(s,{key:1,size:"small",type:"primary",onClick:v=>M(e)},{default:l(()=>[p(" 保存 ")]),_:2},1032,["onClick"])):O("",!0),t(s,{size:"small",type:"primary",onClick:v=>ie(R)(e.name)},{default:l(()=>[p(" 复制 ")]),_:2},1032,["onClick"]),t(s,{size:"small",type:"danger",onClick:v=>L(e)},{default:l(()=>[p("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[X,m.value]]),t(W,{"current-page":V.value,"onUpdate:currentPage":o[6]||(o[6]=e=>V.value=e),"page-size":k.value,"onUpdate:pageSize":o[7]||(o[7]=e=>k.value=e),"page-sizes":[15,50,100,500,((A=f.value)==null?void 0:A.total)??100],total:((w=f.value)==null?void 0:w.total)??100,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:c,onCurrentChange:c},null,8,["current-page","page-size","page-sizes","total"])],64)}}}),Pe=pe(ye,[["__scopeId","data-v-3f8aea2f"]]);export{Pe as default};
